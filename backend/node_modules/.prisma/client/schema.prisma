generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model roles {
  rol_id     Int        @id @default(autoincrement())
  nombre     String     @db.VarChar(100)
  deleted_at DateTime?  @db.Timestamp(6)
  usuarios   usuarios[]
}

model finca {
  finca_id    Int        @id @default(autoincrement())
  nombre      String     @db.VarChar(255)
  descripcion String?
  ubicacion   String?    @db.VarChar(255)
  deleted_at  DateTime?  @db.Timestamp(6)
  usuarios    usuarios[]
}

model usuarios {
  usuario_id     Int              @id @default(autoincrement())
  finca_id       Int?
  rol_id         Int?
  nombre         String           @db.VarChar(255)
  correo         String           @unique @db.VarChar(255)
  contraseña    String?          @db.VarChar(255)
  verificado     Boolean?         @default(false)
  google_oauth   Boolean?         @default(false)
  deleted_at     DateTime?        @db.Timestamp(6)
  notificaciones notificaciones[]
  finca          finca?           @relation(fields: [finca_id], references: [finca_id], onDelete: NoAction, onUpdate: NoAction)
  rol            roles?           @relation(fields: [rol_id], references: [rol_id], onDelete: NoAction, onUpdate: NoAction)
}

model unidades {
  unidad_id          Int                  @id @default(autoincrement())
  nombre             String               @db.VarChar(50)
  deleted_at         DateTime?            @db.Timestamp(6)
  insumos            insumos[]
  pesajes            pesajes[]
  produccion_carne   produccion_carne[]
  producciones_leche produccion_lechera[]
}

model tipo_insumo {
  tipo_insumo_id Int       @id @default(autoincrement())
  nombre         String    @db.VarChar(255)
  deleted_at     DateTime? @db.Timestamp(6)
  insumos        insumos[]
}

model insumos {
  insumo_id               Int                       @id @default(autoincrement())
  tipo_insumo_id          Int?
  nombre                  String                    @db.VarChar(255)
  imagen                  String?                   @db.VarChar(255)
  cantidad                Int
  unidad_id               Int?
  descripcion             String?
  deleted_at              DateTime?                 @db.Timestamp(6)
  alimentaciones          alimentacion[]
  detalle_compras_insumos detalle_compras_insumos[]
  evento_insumos          evento_insumo[]
  tipo_insumo             tipo_insumo?              @relation(fields: [tipo_insumo_id], references: [tipo_insumo_id], onDelete: NoAction, onUpdate: NoAction)
  unidad                  unidades?                 @relation(fields: [unidad_id], references: [unidad_id], onDelete: NoAction, onUpdate: NoAction)
}

model tipo_evento {
  tipo_evento_id     Int                @id @default(autoincrement())
  nombre             String             @db.VarChar(255)
  padre_id           Int?
  deleted_at         DateTime?          @db.Timestamp(6)
  eventos_monta      evento_monta[]
  eventos_parto      evento_parto[]
  eventos_sanitarios evento_sanitario[]
  padre              tipo_evento?       @relation("TipoEventoJerarquia", fields: [padre_id], references: [tipo_evento_id], onDelete: NoAction, onUpdate: NoAction)
  hijos              tipo_evento[]      @relation("TipoEventoJerarquia")
}

model razas {
  raza_id     Int        @id @default(autoincrement())
  nombre      String     @db.VarChar(255)
  descripcion String?
  deleted_at  DateTime?  @db.Timestamp(6)
  animales    animales[]
}

model potreros {
  potrero_id Int       @id @default(autoincrement())
  ubicacion  String    @db.VarChar(255)
  deleted_at DateTime? @db.Timestamp(6)
  lotes      lotes[]
}

model lotes {
  lote_id     Int        @id @default(autoincrement())
  potrero_id  Int?
  codigo      String?    @db.VarChar(20)
  descripcion String?
  deleted_at  DateTime?  @db.Timestamp(6)
  animales    animales[]
  potrero     potreros?  @relation(fields: [potrero_id], references: [potrero_id], onDelete: NoAction, onUpdate: NoAction)
}

model animales {
  animal_id                Int                        @id @default(autoincrement())
  animal_madre_id          Int?
  animal_padre_id          Int?
  lote_id                  Int?
  raza_id                  Int?
  imagen                   String?                    @db.VarChar(255)
  arete                    String                     @unique @db.VarChar(100)
  sexo                     String?                    @db.Char(1)
  fecha_destete            DateTime?                  @db.Date
  fecha_nacimiento         DateTime                   @db.Date
  deleted_at               DateTime?                  @db.Timestamp(6)
  alimentaciones           alimentacion[]
  madre                    animales?                  @relation("Madre", fields: [animal_madre_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  hijos_madre              animales[]                 @relation("Madre")
  padre                    animales?                  @relation("Padre", fields: [animal_padre_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  hijos_padre              animales[]                 @relation("Padre")
  lote                     lotes?                     @relation(fields: [lote_id], references: [lote_id], onDelete: NoAction, onUpdate: NoAction)
  raza                     razas?                     @relation(fields: [raza_id], references: [raza_id], onDelete: NoAction, onUpdate: NoAction)
  detalle_compras_animales detalle_compras_animales[]
  montas_hembra            evento_monta[]             @relation("MontaHembra")
  montas_macho             evento_monta[]             @relation("MontaMacho")
  eventos_sanitarios       evento_sanitario[]
  pesajes                  pesajes[]
  producciones_carne       produccion_carne[]
  producciones_leche       produccion_lechera[]
}

model proveedores {
  proveedor_id      Int                @id @default(autoincrement())
  nombre_compañia  String             @db.VarChar(255)
  nombre_contacto   String?            @db.VarChar(255)
  telefono_local    String?            @db.Char(8)
  telefono_completo String?            @default(dbgenerated("('505'::text || (telefono_local)::text)")) @db.VarChar(20)
  deleted_at        DateTime?          @db.Timestamp(6)
  compras_animales  compras_animales[]
  compras_insumos   compras_insumos[]
}

model compras_insumos {
  compra_insumo_id Int                       @id @default(autoincrement())
  numero_compra    String                    @db.VarChar(20)
  proveedor_id     Int?
  fecha            DateTime                  @db.Date
  deleted_at       DateTime?                 @db.Timestamp(6)
  proveedor        proveedores?              @relation(fields: [proveedor_id], references: [proveedor_id], onDelete: NoAction, onUpdate: NoAction)
  detalles         detalle_compras_insumos[]
}

model detalle_compras_insumos {
  compra_insumo_id Int
  insumo_id        Int
  precio           Decimal         @db.Decimal(10, 2)
  cantidad         Int
  deleted_at       DateTime?       @db.Timestamp(6)
  compra_insumo    compras_insumos @relation(fields: [compra_insumo_id], references: [compra_insumo_id], onDelete: NoAction, onUpdate: NoAction)
  insumo           insumos         @relation(fields: [insumo_id], references: [insumo_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([compra_insumo_id, insumo_id])
}

model compras_animales {
  compra_animal_id Int                        @id @default(autoincrement())
  numero_compra    String                     @db.VarChar(20)
  proveedor_id     Int?
  fecha            DateTime                   @db.Date
  deleted_at       DateTime?                  @db.Timestamp(6)
  proveedor        proveedores?               @relation(fields: [proveedor_id], references: [proveedor_id], onDelete: NoAction, onUpdate: NoAction)
  detalles         detalle_compras_animales[]
}

model detalle_compras_animales {
  compra_animal_id Int
  animal_id        Int
  precio           Decimal          @db.Decimal(10, 2)
  observaciones    String?
  deleted_at       DateTime?        @db.Timestamp(6)
  animal           animales         @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  compra_animal    compras_animales @relation(fields: [compra_animal_id], references: [compra_animal_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([compra_animal_id, animal_id])
}

model evento_sanitario {
  evento_sanitario_id Int             @id @default(autoincrement())
  animal_id           Int?
  tipo_evento_id      Int?
  estado              String?         @db.VarChar(100)
  diagnostico         String?
  tratamiento         String?
  fecha               DateTime        @db.Date
  deleted_at          DateTime?       @db.Timestamp(6)
  numero_evento       String?         @db.VarChar(20)
  evento_insumo       evento_insumo[]
  animal              animales?       @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  tipo_evento         tipo_evento?    @relation(fields: [tipo_evento_id], references: [tipo_evento_id], onDelete: NoAction, onUpdate: NoAction)
}

model evento_insumo {
  evento_sanitario_id Int
  insumo_id           Int
  cantidad            Int
  deleted_at          DateTime?        @db.Timestamp(6)
  evento_sanitario    evento_sanitario @relation(fields: [evento_sanitario_id], references: [evento_sanitario_id], onDelete: NoAction, onUpdate: NoAction)
  insumo              insumos          @relation(fields: [insumo_id], references: [insumo_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([evento_sanitario_id, insumo_id])
}

model alimentacion {
  alimentacion_id     Int       @id @default(autoincrement())
  insumo_id           Int?
  animal_id           Int?
  cantidad            Int
  fecha               DateTime  @db.Date
  deleted_at          DateTime? @db.Timestamp(6)
  numero_alimentacion String?   @db.VarChar(20)
  animal              animales? @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  insumo              insumos?  @relation(fields: [insumo_id], references: [insumo_id], onDelete: NoAction, onUpdate: NoAction)
}

model pesajes {
  pesaje_id          Int                @id @default(autoincrement())
  animal_id          Int?
  unidad_id          Int?
  numero_pesaje      String?            @db.VarChar(20)
  peso               Decimal            @db.Decimal(10, 2)
  fecha              DateTime           @db.Date
  deleted_at         DateTime?          @db.Timestamp(6)
  animal             animales?          @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  unidad             unidades?          @relation(fields: [unidad_id], references: [unidad_id], onDelete: NoAction, onUpdate: NoAction)
  producciones_carne produccion_carne[]
}

model mataderos {
  matadero_id        Int                @id @default(autoincrement())
  ubicacion          String             @db.VarChar(255)
  deleted_at         DateTime?          @db.Timestamp(6)
  producciones_carne produccion_carne[]
}

model produccion_carne {
  produccion_id Int        @id @default(autoincrement())
  animal_id     Int?
  pesaje_id     Int?
  matadero_id   Int?
  peso_canal    Decimal    @db.Decimal(10, 2)
  unidad_id     Int?
  fecha         DateTime   @db.Date
  deleted_at    DateTime?  @db.Timestamp(6)
  animal        animales?  @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  matadero      mataderos? @relation(fields: [matadero_id], references: [matadero_id], onDelete: NoAction, onUpdate: NoAction)
  pesaje        pesajes?   @relation(fields: [pesaje_id], references: [pesaje_id], onDelete: NoAction, onUpdate: NoAction)
  unidad        unidades?  @relation(fields: [unidad_id], references: [unidad_id], onDelete: NoAction, onUpdate: NoAction)
}

model produccion_lechera {
  produccion_id     Int       @id @default(autoincrement())
  animal_id         Int?
  cantidad          Int
  unidad_id         Int?
  fecha             DateTime  @db.Date
  descripcion       String?
  deleted_at        DateTime? @db.Timestamp(6)
  numero_produccion String?   @db.VarChar(20)
  animal            animales? @relation(fields: [animal_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  unidad            unidades? @relation(fields: [unidad_id], references: [unidad_id], onDelete: NoAction, onUpdate: NoAction)
}

model evento_monta {
  monta_id         Int                  @id @default(autoincrement())
  numero_monta     String?              @db.VarChar(20)
  animal_hembra_id Int?
  animal_macho_id  Int?
  tipo_evento_id   Int?
  descripcion      String?
  estado           Boolean?
  fecha            DateTime             @db.Date
  deleted_at       DateTime?            @db.Timestamp(6)
  diagnosticos     diagnostico_prenez[]
  hembra           animales?            @relation("MontaHembra", fields: [animal_hembra_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  macho            animales?            @relation("MontaMacho", fields: [animal_macho_id], references: [animal_id], onDelete: NoAction, onUpdate: NoAction)
  tipo_evento      tipo_evento?         @relation(fields: [tipo_evento_id], references: [tipo_evento_id], onDelete: NoAction, onUpdate: NoAction)
}

model diagnostico_prenez {
  prenez_id            Int            @id @default(autoincrement())
  monta_id             Int?
  metodo               String?        @db.VarChar(100)
  resultado            Boolean?
  fecha_probable_parto DateTime?      @db.Date
  deleted_at           DateTime?      @db.Timestamp(6)
  monta                evento_monta?  @relation(fields: [monta_id], references: [monta_id], onDelete: NoAction, onUpdate: NoAction, map: "diagnostico_preñez_monta_id_fkey")
  partos               evento_parto[]
}

model evento_parto {
  evento_id      Int                 @id @default(autoincrement())
  prenez_id      Int?
  tipo_evento_id Int?
  descripcion    String?
  fecha          DateTime            @db.Date
  deleted_at     DateTime?           @db.Timestamp(6)
  prenez         diagnostico_prenez? @relation(fields: [prenez_id], references: [prenez_id], onDelete: NoAction, onUpdate: NoAction)
  tipo_evento    tipo_evento?        @relation(fields: [tipo_evento_id], references: [tipo_evento_id], onDelete: NoAction, onUpdate: NoAction)
}

model notificaciones {
  notificacion_id Int       @id @default(autoincrement())
  usuario_id      Int?
  titulo          String    @db.VarChar(200)
  mensaje         String
  tipo            String    @db.VarChar(20)
  modulo          String    @db.VarChar(30)
  leida           Boolean
  fecha           DateTime? @db.Timestamp(6)
  deleted_at      DateTime? @db.Timestamp(6)
  usuario         usuarios? @relation(fields: [usuario_id], references: [usuario_id], onDelete: NoAction, onUpdate: NoAction)
}
